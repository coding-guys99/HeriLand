:root{
  /* Theme tokens — bright & modern */
  --bg: #FAF6EF;
  --card: #FFFFFF;
  --line: rgba(0,0,0,.08);
  --text: #1A1A1A;
  --muted: rgba(0,0,0,.55);
  --accent: #2E5E4E;   /* Sarawak green */
  --gold: #E4C77D;     /* Champagne gold */
  --radius: 14px;
  --shadow: 0 6px 24px rgba(0,0,0,.08);
}

*{ box-sizing: border-box }
html,body{ height: 100% }
body{
  margin: 0;
  background: var(--bg);
  color: var(--text);
  font-family: "Inter","Noto Sans TC","Noto Sans SC",system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  line-height: 1.6;
}
img{ max-width: 100%; display: block }
a{ color: inherit; text-decoration: none }
.container{ max-width: 1200px; margin: 0 auto; padding: 0 16px }

.skip-link{ position:absolute; left:-9999px; top:auto }
.skip-link:focus{ left:16px; top:16px; background:#fff; color:#000; padding:8px 12px; border-radius:8px }

/* Header */
.site-header{ position: sticky; top:0; z-index:10; background:var(--bg); border-bottom:1px solid var(--line) }
.header-row{ display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 0 }
.brand{ display:flex; align-items:center; gap:10px; font-weight:800 }
.brand-mark{ width:28px; height:28px }
.top-nav{ display:flex; align-items:center; gap:16px }
.top-nav a{ padding:6px 10px; border-radius:10px }
.top-nav a:hover{ background:var(--card); box-shadow: var(--shadow) }
.btn-ghost{ background:transparent; border:1px solid var(--line); padding:8px 12px; border-radius:10px; cursor:pointer }

/* Hero */
.hero{ background:
  linear-gradient(0deg, rgba(250,246,239,.92), rgba(250,246,239,.92)),
  url('../assets/hero.jpg') center/cover no-repeat;
  padding: 64px 0 40px;
  border-bottom:1px solid var(--line);
}
.hero .lead{ color: var(--muted); margin-top:8px }
.cta-row{ margin-top:18px }
.btn-primary{ background: var(--accent); color:#fff; padding:12px 16px; border-radius:12px; display:inline-block }
.btn-primary:hover{ opacity:.9 }

/* Sections */
.section{ padding: 28px 0 }
.section-head{ display:flex; align-items:baseline; justify-content:space-between; margin-bottom:12px }

/* Chips */
.chips-row{ display:flex; flex-wrap:wrap; gap:10px }
.chips-row .chip{ background:var(--card); border:1px solid var(--line); border-radius:999px; padding:8px 12px; box-shadow: var(--shadow); cursor:pointer }
.chips-row .chip:hover{ transform: translateY(-1px) }

/* Cards */
.card-grid{ display:grid; grid-template-columns: repeat(auto-fill, minmax(240px,1fr)); gap:16px }
.card{ background:var(--card); border:1px solid var(--line); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden }
.card .thumb{ aspect-ratio: 16/9; background:#ddd }
.card .body{ padding:12px }
.card .meta{ display:flex; gap:8px; align-items:center; color:var(--muted); font-size:.92rem }

/* Footer */
.site-footer{ border-top:1px solid var(--line); margin-top:28px }
.footer-row{ display:flex; align-items:center; justify-content:space-between; padding:16px 0 }

/* ===== Modal (Place Detail) ===== */
.modal-backdrop{
  position: fixed; inset: 0; background: rgba(0,0,0,.45);
  display: grid; place-items: center; padding: 24px; z-index: 100;
}
.modal-dialog{
  width: min(920px, 100%);
  background: var(--card);
  color: var(--text);
  border: 1px solid var(--line);
  border-radius: 16px;
  box-shadow: var(--shadow);
  overflow: hidden;
  max-height: 90vh; display: grid; grid-template-columns: 1fr;
}
.modal-close{
  position: absolute; margin: 10px; right: 8px; top: 8px;
  border: 1px solid var(--line); background: #fff; border-radius: 999px;
  width: 36px; height: 36px; cursor: pointer;
}
.modal-gallery{ display: grid; grid-auto-flow: column; grid-auto-columns: 100%; overflow-x: auto; scroll-snap-type: x mandatory }
.modal-gallery img{ width: 100%; height: auto; display: block; aspect-ratio: 16/9; object-fit: cover; scroll-snap-align: start }
.modal-body{ padding: 16px 16px 20px }
.place-meta{ display:flex; gap:12px; color: var(--muted); margin: 6px 0 10px }
.place-info{ display:grid; gap:6px; margin: 10px 0 12px }
.info-row{ color: var(--text) }
.action-row{ display:flex; flex-wrap:wrap; gap:10px; margin-top: 12px }
.btn.action{
  background: var(--card); border:1px solid var(--line); border-radius: 12px;
  padding: 8px 12px; cursor: pointer; display:inline-flex; align-items:center; gap:6px;
}
.btn.action[disabled]{ opacity:.4; cursor:not-allowed }
@media (min-width: 840px){
  .modal-dialog{ grid-template-columns: 5fr 7fr }
  .modal-gallery{ height: 100%; }
  .modal-gallery img{ height: 100%; aspect-ratio: auto }
}

/* 確保關閉鈕定位在對的容器上方 */
.modal-dialog{ position: relative; }           /* <— 新增 */
.modal-close{ z-index: 200; position: absolute; }  /* 若已存在，補 z-index:200; */

/* 讓 hidden 屬性真的能隱藏 modal（避免被 .modal-backdrop 的 display 覆蓋） */
.modal-backdrop[hidden]{ display: none !important; }

/* Backdrop & dialog transitions */
.modal-backdrop{
  /* 既有: position, display:grid ... 保留 */
  opacity: 0;
  transition: opacity .22s ease;
}
.modal-backdrop[aria-hidden="false"]{ opacity: 1; }

/* 讓關閉時也能過場：在動畫結束前不要 display:none */
.modal-backdrop[hidden]{ display:none !important; }

/* Dialog 進場微浮動 */
.modal-dialog{
  transform: translateY(6px) scale(.985);
  opacity: 0;
  transition: transform .24s ease, opacity .24s ease;
}
.modal-backdrop[aria-hidden="false"] .modal-dialog{
  transform: translateY(0) scale(1);
  opacity: 1;
}

/* 行動優先：小螢幕預設就很好用；加一個斷點優化桌機 */
@media (min-width: 840px){
  .modal-dialog{ grid-template-columns: 5fr 7fr; }
}

/* 已有：確保關閉鈕可點到 */
.modal-dialog{ position: relative; }
.modal-close{ position: absolute; z-index: 200; right: 8px; top: 8px; }

/* ===== Header RWD ===== */
.nav-toggle{
  display:inline-flex; align-items:center; justify-content:center;
  width:40px; height:40px; border:1px solid var(--line);
  border-radius:10px; background:#fff; cursor:pointer;
}

/* 行動版：nav 變成浮出選單，預設關閉 */
.top-nav{
  position: absolute;
  top: 100%;
  right: 16px;
  display: none;                   /* 關閉狀態 */
  flex-direction: column;
  gap: 8px;
  background: var(--card);
  border: 1px solid var(--line);
  border-radius: 12px;
  box-shadow: var(--shadow);
  padding: 10px;
  margin-top: 8px;
  z-index: 20;
}
.top-nav a,
.top-nav .btn-ghost{ padding:8px 10px; border-radius:10px; text-align:left }
.top-nav.open{ display:flex; }     /* ★ 打開狀態 */

/* 桌機版：恢復水平導覽，隱藏漢堡鈕、取消浮出樣式 */
@media (min-width: 840px){
  .nav-toggle{ display:none; }
  .top-nav{
    position: static;
    display: flex !important;
    flex-direction: row;
    gap: 16px;
    background: transparent;
    border: 0;
    border-radius: 0;
    box-shadow: none;
    padding: 0;
    margin: 0;
  }
  .top-nav a,
  .top-nav .btn-ghost{ text-align:inherit }
}

/* 讓 header 疊在浮出的 nav 之上 */
.site-header{ position: sticky; top:0; z-index: 50; }
.header-row{ position: relative; } /* 讓絕對定位的 .top-nav 以它為參考 */

/* ===== Poster Hero ===== */
.hero.hero-poster{ position:relative; padding: 82px 0 56px; border:0 }
.hero .display{ font-size: clamp(28px, 5vw, 48px); line-height:1.1; letter-spacing:.2px; margin:0 }
.hero .sub{ margin:10px 0 16px; color:var(--muted); font-size: clamp(14px, 2.6vw, 18px) }
.hero .hero-cta{ display:flex; gap:10px; flex-wrap:wrap }

/* 背景層：主圖 + 金色漸層 + 民族紋理 */
.poster-bg{ position:absolute; inset:0; overflow:hidden; z-index:-1 }
.poster-bg img{ width:100%; height:100%; object-fit:cover; transform: scale(1.02) }
.poster-overlay{
  position:absolute; inset:0;
  background: radial-gradient(120% 80% at 70% 20%, rgba(228,199,125,.45), transparent 60%),
              linear-gradient(180deg, rgba(250,246,239,.88) 0%, rgba(250,246,239,.92) 40%, rgba(250,246,239,.98) 100%);
}
.poster-pattern{
  position:absolute; inset:0; opacity:.18;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(46,94,78,.25) 0 2px, transparent 3px),
    radial-gradient(circle at 80% 60%, rgba(199,75,42,.25) 0 2px, transparent 3px);
  background-size: 200px 200px, 260px 260px;
  mix-blend-mode: multiply;
}

/* Division mosaic */
.division-grid{
  --min: 140px;
  display:grid; gap:12px;
  grid-template-columns: repeat(auto-fill, minmax(var(--min),1fr));
}
.division-card{
  position:relative; isolation:isolate; border:0; cursor:pointer;
  background: var(--card); border:1px solid var(--line);
  border-radius: 16px; padding: 16px 14px; text-align:left; box-shadow: var(--shadow);
  display:flex; align-items:center; gap:12px;
}
.division-card .tile{
  width:42px; height:42px; border-radius:12px; background: var(--tile);
  box-shadow: inset 0 -10px 16px rgba(0,0,0,.12);
  display:inline-block;
}
.division-card .label{ font-weight:700; letter-spacing:.2px }
.division-card:hover{ transform: translateY(-2px); }
@media (max-width: 720px){
  .division-grid{ grid-auto-flow: column; grid-auto-columns: 60%; overflow-x:auto; scroll-snap-type:x mandatory }
  .division-card{ scroll-snap-align: start; min-width: 60% }
}

#themeChips .chip{
  border:0; box-shadow: var(--shadow); font-weight:700;
  background: linear-gradient(180deg, #fff, #f7f4ec);
}
#themeChips .chip[data-theme="taste"]{ background: #FFEFD6 }
#themeChips .chip[data-theme="culture"]{ background: #E9F5FF }
#themeChips .chip[data-theme="nature"]{ background: #E8F6EF }
#themeChips .chip[data-theme="stay"]{ background: #F0ECFF }
#themeChips .chip[data-theme="event"]{ background: #FFE8EE }

.bottom-bar{
  position: fixed; bottom: 12px; left: 50%; transform: translateX(-50%);
  background: rgba(255,255,255,.92); backdrop-filter: blur(10px);
  border: 1px solid var(--line); border-radius: 16px; box-shadow: var(--shadow);
  display: none; gap: 10px; padding: 8px 12px; z-index: 60;
}
.bb-item{
  display:flex; flex-direction:column; align-items:center; gap:4px;
  padding:6px 10px; border-radius:12px; border:0; background:transparent; cursor:pointer; font-size:13px;
}
.bb-item span{ font-size:12px }
@media (max-width: 840px){ .bottom-bar{ display:flex; } }

/* 區塊進場淡入 */
.section .container{ animation: fadeUp .4s ease both; }
.section:nth-of-type(2) .container{ animation-delay: .05s; }
.section:nth-of-type(3) .container{ animation-delay: .1s; }
@keyframes fadeUp{ from{ opacity:0; transform: translateY(6px) } to{ opacity:1; transform:none } }

.page-hero{
  padding: 48px 0 32px;
  text-align:center;
  background: linear-gradient(180deg, #faf6ef 60%, #fff);
}
.page-hero h1{ font-size:2rem; margin:0 }
.page-hero .lead{ color:var(--muted); margin-top:6px }
.search-box{ margin-top:16px }
.search-box input{
  width:100%; max-width:420px; font-size:1rem;
  padding:10px 14px; border:1px solid var(--line);
  border-radius:10px; background:#fff;
}
.chip.active{ background:var(--accent); color:#fff; }

/* ===== Explore Toolbar ===== */
.toolbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.toolbar-right{ display:flex; align-items:center; gap:12px; }
.sort select{ border:1px solid var(--line); border-radius:10px; padding:6px 10px; background:#fff; }
.density{ display:inline-flex; border:1px solid var(--line); border-radius:12px; overflow:hidden }
.density button{ padding:6px 10px; background:#fff; border:0; cursor:pointer }
.density button.on{ background:var(--card); font-weight:700 }

/* ===== List-first Grid ===== */
.card-grid{ display:grid; gap:16px; }
@media (min-width: 480px){ .card-grid{ grid-template-columns: repeat(2, 1fr); } }
@media (min-width: 840px){ .card-grid{ grid-template-columns: repeat(3, 1fr); } }
@media (min-width: 1200px){ .card-grid{ grid-template-columns: repeat(4, 1fr); } }

/* Cozy vs Compact density */
.card-grid--cozy .card .thumb{ aspect-ratio: 16/10; }
.card-grid--compact .card .thumb{ aspect-ratio: 3/2; }
.card-grid--compact .card .body{ padding:10px }
.card-grid--compact .card h3{ font-size: 1rem; }

/* Glass cards（延用你原本＋微調） */
.card{
  background: linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.96));
  backdrop-filter: blur(6px);
  border: 1px solid rgba(255,255,255,.7);
  transition: transform .15s ease;
}
.card:hover{ transform: translateY(-2px); }
.card .meta span{
  background:#fff; border:1px solid var(--line); border-radius:999px; padding:2px 8px;
}

/* Load more area */
.load-more-wrap{ display:flex; justify-content:center; margin-top:14px }

/* ===== Skeleton while loading ===== */
.skeleton{ position:relative; overflow:hidden; background:#eee; }
.skeleton::after{
  content:""; position:absolute; inset:0;
  background: linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,.6) 50%, rgba(255,255,255,0) 100%);
  transform: translateX(-100%); animation: shine 1.1s infinite;
}
@keyframes shine{ to{ transform: translateX(100%); } }
.card.is-loading .thumb{ background:#e9e7e2 }
.card.is-loading .body{ padding:12px }
.card.is-loading h3{ height:16px; width:70%; margin:8px 0; background:#eee }
.card.is-loading .meta{ height:14px; width:50%; background:#eee; border-radius:8px }

/* ===== Bottom TabBar (Glass only at bottom) ===== */
.tabbar{
  position: fixed; left: 0; right: 0; bottom: 0;
  display: grid; grid-template-columns: repeat(5,1fr);
  align-items: center;
  padding: 8px 10px calc(8px + env(safe-area-inset-bottom));
  background: color-mix(in srgb, #ffffff 86%, transparent);
  backdrop-filter: blur(16px) saturate(120%);
  -webkit-backdrop-filter: blur(16px) saturate(120%);
  border-top: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 -8px 24px rgba(0,0,0,.10);
  z-index: 1000;
}
.tabbar .tab{
  appearance:none; background:transparent; border:0; margin:0;
  height: 48px; padding: 6px 8px; border-radius: 12px;
  display:inline-flex; flex-direction:column; align-items:center; justify-content:center;
  gap:4px; color:#233; text-decoration:none; position:relative; cursor:pointer;
}
.tabbar .ico{ font-size:20px; line-height:1 }
.tabbar .txt{ font-size:11px; line-height:1; opacity:.85 }
.tabbar .tab.active{
  background: rgba(255,255,255,.9);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.06), 0 6px 12px rgba(0,0,0,.08);
}
.tabbar .tab.active::after{
  content:""; position:absolute; bottom:4px; width:6px; height:6px; border-radius:50%;
  background:#2E5E4E;
}
/* 內容區避免被遮住 */
body{ padding-bottom: calc(72px + env(safe-area-inset-bottom)); }
/* 深色保護 */
@media (prefers-color-scheme: dark){
  .tabbar{
    background: color-mix(in srgb, #0b0f12 55%, transparent);
    border-top-color: rgba(255,255,255,.08);
    box-shadow: 0 -8px 24px rgba(0,0,0,.5);
  }
  .tabbar .tab{ color:#f7f7f7 }
  .tabbar .tab.active{ background: rgba(255,255,255,.08) }
}

/* ===== AppBar with glass search pill ===== */
.appbar{ position: sticky; top: 0; z-index: 40; background: var(--bg); border-bottom: 1px solid var(--line); }
.appbar-inner{ display:flex; align-items:center; gap:10px; padding:10px 12px; }
.appbar .brand-mark{ width:28px; height:28px }
.icon-btn{ background:transparent; border:0; font-size:18px; padding:6px; cursor:pointer }
.search-pill{
  flex:1; display:flex; align-items:center; gap:8px; padding:10px 12px;
  background: color-mix(in srgb, #ffffff 86%, transparent);
  -webkit-backdrop-filter: blur(10px) saturate(120%); backdrop-filter: blur(10px) saturate(120%);
  border:1px solid rgba(0,0,0,.06); border-radius: 999px; color:#222; cursor:pointer;
}
.search-pill span{ font-size:13px; opacity:.75 }

/* ===== Hero Rail（低矮輪播） ===== */
.hero-rail{ padding: 8px 0; }
.hero-rail .rail{
  display:grid; grid-auto-flow: column; grid-auto-columns: 80%; gap:10px;
  overflow-x:auto; padding: 0 12px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling: touch;
}
.hero-card{ position:relative; display:block; border-radius:16px; overflow:hidden; scroll-snap-align:start;
  box-shadow: var(--shadow); }
.hero-card img{ width:100%; height:120px; object-fit:cover; display:block }
.hero-caption{
  position:absolute; left:8px; bottom:8px; right:8px; color:#fff; font-weight:700;
  text-shadow: 0 2px 8px rgba(0,0,0,.45);
}
.hero-caption .ad{
  font-style: normal; font-weight:700; font-size:11px; margin-left:6px; padding:2px 6px; border-radius:999px;
  background: rgba(0,0,0,.55);
}

/* ===== Rows（Netflix-style） ===== */
.rows .row-section{ padding: 10px 0 4px; }
.row-head{ display:flex; align-items:baseline; justify-content:space-between; padding: 0 12px 6px; }
.row-head h2{ margin:0; font-size:16px }
.row-head .see-all{ font-size:12px; color: var(--accent) }

.rail{
  display:grid; grid-auto-flow: column; grid-auto-columns: 38%; gap:10px;
  overflow-x:auto; padding: 0 12px 4px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling: touch;
}
.rail > *{ scroll-snap-align: start }

/* Poster 卡（2:3） */
.card.poster{ width:100%; }
.card.poster .thumb{ width:100%; aspect-ratio: 2/3; background:#ddd center/cover no-repeat; border-radius: 12px; box-shadow: var(--shadow); }
.card.poster .t{ margin:6px 2px 0; font-size:13px; line-height:1.3; }

/* Mini 卡（16:9 橫圖） */
.card.mini .thumb{ width:100%; aspect-ratio:16/9; background:#ddd center/cover no-repeat; border-radius: 12px; box-shadow: var(--shadow); }
.card.mini .meta{ font-size:12px; color:var(--muted); margin:6px 2px 0 }

/* Division 小卡（1:1 pill） */
.division-pill{
  display:inline-flex; align-items:center; justify-content:center; padding:10px 12px; border-radius:12px;
  background:#fff; border:1px solid var(--line); box-shadow: var(--shadow); min-width: 120px; height: 48px;
  color:inherit; text-decoration:none;
}

/* Chips 橫滑（沿用你的 mobile 規則） */
.mobile-app .chips-row{
  display:grid; grid-auto-flow:column; grid-auto-columns:max-content; overflow-x:auto; gap:8px; padding:0 12px 6px;
  scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch;
}
.mobile-app .chips-row .chip{ scroll-snap-align:start }

/* TabBar（已存在的樣式保留）與內容 padding */
body{ padding-bottom: calc(72px + env(safe-area-inset-bottom)); }

/* ===== Base（你原本的 tabbar 覆用） ===== */
.tabbar{
  position: fixed; left: 0; right: 0; bottom: 0;
  z-index: 1000;
  padding: 8px 10px calc(8px + env(safe-area-inset-bottom));
}
.tabbar .tab{
  appearance:none; border:0; margin:0;
  height: 48px; width: 48px; border-radius: 999px;
  display:inline-flex; align-items:center; justify-content:center;
  background: transparent; color:#233; cursor:pointer;
  position: relative;
}
.tabbar .ico{ font-size: 20px; line-height: 1 }
.tabbar .txt{ position:absolute; width:1px; height:1px; margin:-1px; clip:rect(0 0 0 0); overflow:hidden; } /* 視覺隱藏但保留語意 */
.tabbar .tab.active::after{
  content:""; position:absolute; bottom:4px; width:6px; height:6px; border-radius:50%;
  background:#2E5E4E;
}

/* ===== Capsule variant（中置、不滿版、玻璃） ===== */
.tabbar--capsule{
  display:flex; justify-content:center; pointer-events:none; /* 只讓膠囊區能點 */
}
.tabbar--capsule::before{ content:""; } /* Safari 層疊保護 */
.tabbar--capsule .capsule{
  /* 可選：若你想用包一層 .capsule，下面這段就用；我們直接套在 nav 本身也可以 */
}
.tabbar--capsule{
  /* 將 nav 本身當作容器 */
}
.tabbar--capsule > * { pointer-events:auto; }

.tabbar--capsule{
  /* 中置膠囊背景 */
}
.tabbar--capsule .tabbar-shell{
  /* 如果要包一層外殼可用，這裡先不用 */
}

/* 直接把 tab 放進一個玻璃膠囊 */
.tabbar--capsule{
  /* 內部 Grid：5 個等寬 icon */
}
.tabbar--capsule .tabwrap{
  display:grid; grid-auto-flow:column; grid-auto-columns: 1fr; gap: 6px;
}
.tabbar--capsule .bg{
  position:absolute; left:50%; transform:translateX(-50%);
  bottom: calc(8px + env(safe-area-inset-bottom));
  width: min(92%, 480px); height: 56px;
  background: color-mix(in srgb, #ffffff 86%, transparent);
  -webkit-backdrop-filter: blur(16px) saturate(120%); backdrop-filter: blur(16px) saturate(120%);
  border: 1px solid rgba(0,0,0,.06);
  border-radius: 999px;
  box-shadow: 0 6px 22px rgba(0,0,0,.12);
  z-index: 0;
}

/* 讓按鈕在膠囊上方，並置中排列 */
.tabbar--capsule .tab{
  position: relative; z-index: 1;
  margin: 0 4px;
  width: 48px; height: 48px;
}
.tabbar--capsule .tab.active{
  background: rgba(255,255,255,.9);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.06), 0 6px 12px rgba(0,0,0,.08);
}

/* 讓內容不被遮住 */
body{ padding-bottom: calc(76px + env(safe-area-inset-bottom)); }

/* 深色保護 */
@media (prefers-color-scheme: dark){
  .tabbar--capsule .bg{
    background: color-mix(in srgb, #0b0f12 55%, transparent);
    border-color: rgba(255,255,255,.08);
    box-shadow: 0 6px 22px rgba(0,0,0,.5);
  }
  .tabbar .tab{ color:#f7f7f7 }
  .tabbar .tab.active{ background: rgba(255,255,255,.08) }
}