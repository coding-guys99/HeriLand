<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tabbar RWD Test</title>
<style>
:root{
  --bg:#FAF6EF;
  --text:#1A1A1A;
  --muted:rgba(0,0,0,.55);
  --line:rgba(0,0,0,.08);
  --glass: color-mix(in srgb, #ffffff 86%, transparent);
  --blur: 16px;
  --accent:#2E5E4E;
  --radius: 12px;               /* æ‰‹æ©Ÿé¸ä¸­å¡Šï¼š8â€“13ä¹‹é–“ï¼Œå…ˆç”¨12 */
  --radius-desktop:10px;        /* æ¡Œæ©Ÿé¸ä¸­å¡Š */
  --tab-h:56px;
  --safe: env(safe-area-inset-bottom, 0px);
  --anim: 180ms cubic-bezier(.22,.55,.22,1); /* å¹³æ»‘ã€è€çœ‹ */
}

/* Base */
*{ box-sizing:border-box }
html,body{ height:100% }
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family: system-ui, -apple-system, "Inter", "Noto Sans TC", sans-serif;
  line-height:1.6;
  scroll-behavior:smooth; /* å¹³æ»‘æ»¾å‹• */
  padding-bottom: calc(var(--tab-h) + var(--safe)); /* é¿å…è¢«åº•éƒ¨å°è¦½é®ä½ï¼ˆè¡Œå‹•ï¼‰ */
}
h1,h2{ margin:0 0 8px }
p{ margin:0 0 12px }

/* é¡¶éƒ¨ AppBarï¼ˆæ¡Œæ©Ÿå¯ç•¶å·¥å…·åˆ—å ä½ï¼‰ */
.header{
  position: sticky; top:0; z-index:5;
  display:flex; align-items:center; gap:12px;
  padding:12px 16px; border-bottom:1px solid var(--line);
  background: linear-gradient(180deg, rgba(250,246,239,.86), rgba(250,246,239,.98));
  backdrop-filter: blur(6px);
}
.header .hello{ font-weight:800; letter-spacing:.2px }
.header .sub{ font-size:12px; color:var(--muted) }

/* å…§å®¹å€å¡Šï¼ˆåšæˆäº”å±ï¼Œæ¼”ç¤ºå¹³æ»‘åˆ‡æ›ï¼‰ */
.section{
  min-height: 90vh; padding: 20px 16px 40px;
  display:grid; align-content:start; gap:10px;
  border-bottom:1px solid var(--line);
}
.section .card{
  background:#fff; border:1px solid var(--line); border-radius:14px;
  padding:14px; box-shadow: 0 8px 24px rgba(0,0,0,.06);
}

/* ===== å°è¦½ï¼šè¡Œå‹•ï¼ˆåº•éƒ¨ 5-tab è† å›Šï¼‰ ===== */
.tabbar{
  position: fixed; left:0; right:0; bottom:0; z-index:100;
  display:flex; justify-content:center; align-items:center;
  padding: 8px 10px calc(8px + var(--safe));
  background: transparent; /* ç»ç’ƒè† å›Šæœ¬èº«åšåœ¨å…§éƒ¨å®¹å™¨ */
  pointer-events:none;     /* åªè®“å…§éƒ¨å¯é» */
}
.tabbar .shell{
  position: relative;
  width: min(92%, 520px); height: var(--tab-h);
  background: var(--glass);
  -webkit-backdrop-filter: blur(var(--blur)) saturate(120%);
  backdrop-filter: blur(var(--blur)) saturate(120%);
  border:1px solid rgba(0,0,0,.06);
  border-radius: 999px;
  box-shadow: 0 8px 24px rgba(0,0,0,.12);
  pointer-events:auto;
  display:grid; grid-template-columns: repeat(5, 1fr);
}
.tabbar button{
  appearance:none; border:0; background:transparent; margin:0;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  gap:4px; font-size:11px; color:#233; cursor:pointer; position:relative;
}

/* å‹•æ…‹é¸ä¸­å¡Šï¼ˆè† å›Šï¼‰ */
.tabbar .pill{
  position:absolute; inset:4px auto 4px 4px;
  width: calc((100% - 8px) / 5); /* 5 å€‹æ¬„ä½ */
  border-radius: var(--radius);
  background: rgba(255,255,255,.96);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,.06), 0 8px 18px rgba(0,0,0,.14);
  transform: translateX(0);
  transition: transform var(--anim);
  will-change: transform;
  z-index:0;
}
.tabbar .icon, .tabbar .label{ position:relative; z-index:1 }
.tabbar .icon{ font-size:18px; line-height:1 }
.tabbar .label{ opacity:.85 }

/* é¸ä¸­æ…‹æ–‡å­—åŠ ç²—ä¸€é» */
.tabbar button[aria-current="page"] .label{ font-weight:700 }

/* ===== æ¡Œæ©Ÿï¼šé ‚éƒ¨å°è¦½ï¼ˆå–ä»£åº•éƒ¨ï¼‰ ===== */
@media (min-width: 840px){
  body{ padding-bottom: 0 } /* æ¡Œæ©Ÿæ²’æœ‰åº•éƒ¨å°è¦½ */
  .tabbar{ display:none }

  .topnav{
    position: sticky; top:0; z-index:6;
    border-bottom:1px solid var(--line);
    background: var(--glass);
    -webkit-backdrop-filter: blur(var(--blur)) saturate(120%);
    backdrop-filter: blur(var(--blur)) saturate(120%);
    box-shadow: 0 8px 24px rgba(0,0,0,.10);
  }
  .topnav .track{
    position:relative; max-width:1200px; margin:0 auto; padding: 8px 16px;
    display:grid; grid-template-columns: repeat(5, max-content); gap:8px;
  }
  .topnav .pill{
    position:absolute; top:6px; bottom:6px; left:16px; width:auto;
    border-radius: var(--radius-desktop);
    background: rgba(255,255,255,.96);
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.06), 0 8px 18px rgba(0,0,0,.14);
    transition: transform var(--anim), width var(--anim);
    will-change: transform, width;
    z-index:0;
  }
  .topnav button{
    position:relative; z-index:1;
    appearance:none; border:0; background:transparent; cursor:pointer;
    font-weight:600; padding: 10px 12px; border-radius: 10px;
  }
  .topnav button[aria-current="page"]{ color:#000; }
}

/* å¯åŠæ€§ï¼šéµç›¤ç„¦é» */
button:focus-visible{
  outline: 2px solid color-mix(in srgb, var(--accent) 65%, #fff 35%);
  outline-offset: 2px;
  border-radius: 10px;
}

/* æ¸›å°‘å‹•æ•ˆåå¥½ */
@media (prefers-reduced-motion: reduce){
  :root{ --anim: 0ms linear }
  .tabbar .pill, .topnav .pill{ transition: none }
}

/* å°å°çš„å…§å®¹é¡è‰² */
.muted{ color: var(--muted) }
.demo-block{ display:grid; gap:12px }
</style>
</head>
<body>

<!-- é ‚éƒ¨å•å€™ï¼ˆæ‰‹æ©Ÿ/æ¡Œæ©Ÿéƒ½é¡¯ç¤ºï¼‰ -->
<header class="header">
  <div>
    <div class="hello">Hello</div>
    <div class="sub">Explore Sarawak</div>
  </div>
</header>

<!-- æ¡Œæ©Ÿé ‚éƒ¨å°è¦½ï¼ˆâ‰¥840px é¡¯ç¤ºï¼‰ -->
<nav class="topnav" aria-label="Primary" hidden>
  <div class="track" id="topTrack">
    <div class="pill" id="topPill" aria-hidden="true"></div>
    <button data-target="#home"   class="tn" aria-current="page">Home</button>
    <button data-target="#search" class="tn">Search</button>
    <button data-target="#explore" class="tn">Explore</button>
    <button data-target="#saved"  class="tn">Saved</button>
    <button data-target="#me"     class="tn">Me</button>
  </div>
</nav>

<main>
  <section id="home" class="section">
    <h2>Home</h2>
    <div class="demo-block">
      <div class="card"><strong>Hero</strong><div class="muted">è¼ªæ’­ / æ´»å‹• / ç²¾é¸æ¨¡çµ„</div></div>
      <div class="card"><strong>Rows</strong><div class="muted">Netflix-style rails</div></div>
    </div>
  </section>

  <section id="search" class="section">
    <h2>Search</h2>
    <div class="card"><strong>Overlay</strong><div class="muted">ç»ç’ƒæœå°‹ã€çµæœåˆ—è¡¨</div></div>
  </section>

  <section id="explore" class="section">
    <h2>Explore</h2>
    <div class="card"><strong>Grid</strong><div class="muted">å¤šæ¬„å¡ç‰‡ / ç¯©é¸å·¥å…·åˆ—</div></div>
  </section>

  <section id="saved" class="section">
    <h2>Saved</h2>
    <div class="card"><strong>Favorites</strong><div class="muted">æ”¶è—æ¸…å–® / é›¢ç·š</div></div>
  </section>

  <section id="me" class="section">
    <h2>Me</h2>
    <div class="card"><strong>Profile</strong><div class="muted">ç™»å…¥ / è¨­å®š</div></div>
  </section>
</main>

<!-- æ‰‹æ©Ÿåº•éƒ¨ 5-tab -->
<nav class="tabbar" aria-label="Primary">
  <div class="shell" id="tabShell">
    <div class="pill" id="tabPill" aria-hidden="true"></div>
    <button class="tab" data-target="#home"   aria-current="page">
      <div class="icon">ğŸ </div><div class="label">Home</div>
    </button>
    <button class="tab" data-target="#search">
      <div class="icon">ğŸ”</div><div class="label">Search</div>
    </button>
    <button class="tab" data-target="#explore">
      <div class="icon">ğŸ—ºï¸</div><div class="label">Explore</div>
    </button>
    <button class="tab" data-target="#saved">
      <div class="icon">â¤ï¸</div><div class="label">Saved</div>
    </button>
    <button class="tab" data-target="#me">
      <div class="icon">ğŸ™‚</div><div class="label">Me</div>
    </button>
  </div>
</nav>

<script>
/* ----------
  Core è¡Œç‚ºï¼š
  1) é»æ“Š tab/é ‚éƒ¨æŒ‰éˆ• â†’ å¹³æ»‘æ»¾å‹•åˆ°å°æ‡‰ section
  2) ScrollSpy â†’ è‡ªå‹•é«˜äº®ç›®å‰å€æ®µ
  3) å‹•æ…‹è† å›Šï¼ˆpillï¼‰ç”¨ transform/width ç§»å‹•ï¼ˆæ•ˆèƒ½ä½³ï¼‰
---------- */
const sections = [...document.querySelectorAll('main .section')];
const ids = sections.map(s => '#' + s.id);

// Mobile tab
const tabShell = document.getElementById('tabShell');
const tabPill  = document.getElementById('tabPill');
const tabs     = [...tabShell.querySelectorAll('button.tab')];

// Desktop topnav
const topnav   = document.querySelector('.topnav');
const topTrack = document.getElementById('topTrack');
const topPill  = document.getElementById('topPill');
const tns      = topTrack ? [...topTrack.querySelectorAll('button.tn')] : [];

// RWDï¼šâ‰¥840 é¡¯ç¤º topnavã€éš±è—åº•éƒ¨
function applyRWD(){
  const isDesktop = window.matchMedia('(min-width: 840px)').matches;
  if (topnav) topnav.hidden = !isDesktop;
}
applyRWD();
window.addEventListener('resize', applyRWD);

// ç§»å‹• mobile è† å›Š
function moveTabPill(index){
  if (!tabPill) return;
  const w = tabShell.clientWidth - 8;      // å…©å´ inset: 4px + 4px
  const cellW = w / 5;
  tabPill.style.transform = `translateX(${index * cellW}px)`;
}

// ç§»å‹• desktop è† å›Šï¼ˆéœ€è¦é‡æ¸¬æŒ‰éˆ•å¯¬ï¼‰
function moveTopPill(index){
  if (!topPill || !tns[index]) return;
  const btn = tns[index];
  const trackRect = topTrack.getBoundingClientRect();
  const btnRect   = btn.getBoundingClientRect();
  const x = btnRect.left - trackRect.left - 4; // å¾®å…§ç¸®
  const w = btnRect.width + 8;
  topPill.style.transform = `translateX(${x}px)`;
  topPill.style.width = `${w}px`;
}

// è¨­å®šç›®å‰ activeï¼ˆaria-currentï¼‰
function setActiveById(hash){
  // mobile
  tabs.forEach((b)=> b.removeAttribute('aria-current'));
  const mIdx = tabs.findIndex(b => b.dataset.target === hash);
  if (mIdx >= 0) tabs[mIdx].setAttribute('aria-current','page');

  // desktop
  tns.forEach((b)=> b.removeAttribute('aria-current'));
  const dIdx = tns.findIndex(b => b.dataset.target === hash);
  if (dIdx >= 0) tns[dIdx].setAttribute('aria-current','page');

  // ç§»å‹•æŒ‡ç¤ºè† å›Š
  if (mIdx >= 0) moveTabPill(mIdx);
  if (dIdx >= 0) moveTopPill(dIdx);
}

// é»æ“Šå°è¦½ â†’ æ»¾åˆ°è©²å€
function onNavClick(e){
  const btn = e.currentTarget;
  const target = document.querySelector(btn.dataset.target);
  if (!target) return;
  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
tabs.forEach(b => b.addEventListener('click', onNavClick));
tns.forEach(b => b.addEventListener('click', onNavClick));

// ScrollSpyï¼šè§€å¯Ÿ section é€²å‡ºè¦–çª—
const spy = new IntersectionObserver((entries)=>{
  // æŒ‰å¯è¦‹æ¯”ä¾‹æ’åºï¼Œå–æœ€å¯è¦‹çš„é‚£å€‹
  const vis = entries
    .filter(en => en.isIntersecting)
    .sort((a,b)=> b.intersectionRatio - a.intersectionRatio)[0];

  if (vis){
    const id = '#' + vis.target.id;
    setActiveById(id);
    history.replaceState(null,'',id); // æ›´æ–° URL ç‰‡æ®µï¼ˆä¸é‡è¼‰ï¼‰
  }
}, { rootMargin: '-40% 0px -55% 0px', threshold:[0, .25, .5, .75, 1] });

sections.forEach(sec => spy.observe(sec));

// åˆå§‹å®šä½ï¼ˆæ ¹æ“š URL hashï¼‰
(function initFromHash(){
  const h = location.hash && ids.includes(location.hash) ? location.hash : '#home';
  setActiveById(h);
  // è‹¥ç›´æ¥æ‰“é–‹éé ‚éƒ¨ï¼šè¼•è¼•æ»¾ä¸€ä¸‹åˆ°æ­£ä½
  const tgt = document.querySelector(h);
  if (tgt) setTimeout(()=> tgt.scrollIntoView({behavior:'auto', block:'start'}), 0);
})();
</script>
</body>
</html>